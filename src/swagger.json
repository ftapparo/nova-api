{
  "openapi": "3.0.1",
  "info": {
    "title": "NOVA-API",
    "description": "API de serviços para condomínio Nova Residence Quintas das Paineiras.",
    "version": "2.0.0"
  },
  "tags": [
    {
      "name": "Monitoramento",
      "description": "Verificacao de status e saude da API (health check)."
    },
    {
      "name": "Acessos",
      "description": "Operacoes relacionadas a verificacao, liberacao e registro de acessos (pedestres e veiculos)."
    },
    {
      "name": "Veiculos",
      "description": "Gerenciamento de dados de veiculos, incluindo cadastro, bloqueio, imagem e TAG de acesso."
    },
    {
      "name": "Exaustores",
      "description": "Controle de exaustores das churrasqueiras (ligar, desligar e status)."
    }
  ],
  "paths": {
    "/v2/api/health": {
      "get": {
        "tags": [
          "Monitoramento"
        ],
        "summary": "Verificacao de status da API",
        "description": "Retorna o status de funcionamento da API e o ambiente atual.",
        "responses": {
          "200": {
            "description": "API em funcionamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "string",
                          "example": "API Funcionando!"
                        },
                        "environment": {
                          "type": "string",
                          "example": "development"
                        }
                      }
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/healthcheck": {
      "get": {
        "tags": [
          "Monitoramento"
        ],
        "summary": "Verificacao de status da API",
        "description": "Retorna o status de funcionamento da API e o ambiente atual.",
        "responses": {
          "200": {
            "description": "API em funcionamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "string",
                          "example": "API Funcionando!"
                        },
                        "environment": {
                          "type": "string",
                          "example": "development"
                        }
                      }
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/access/verify": {
      "get": {
        "tags": [
          "Acessos"
        ],
        "summary": "Verificar permissao de acesso",
        "description": "Verifica se uma pessoa ou veiculo possui permissao para acessar o condominio.",
        "parameters": [
          {
            "in": "query",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "dispositivo",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "sentido",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "foto",
            "required": false,
            "schema": {
              "type": "string",
              "maxLength": 4
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Permissao de acesso verificada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "string",
                      "example": "IDENT:..."
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/access/register": {
      "post": {
        "tags": [
          "Acessos"
        ],
        "summary": "Registrar novo acesso",
        "description": "Registra um novo evento de acesso ao sistema (entrada ou saida).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "dispositivo",
                  "pessoa",
                  "sentido",
                  "idAcesso"
                ],
                "properties": {
                  "dispositivo": {
                    "type": "integer"
                  },
                  "pessoa": {
                    "type": "integer"
                  },
                  "classificacao": {
                    "type": "integer"
                  },
                  "classAutorizado": {
                    "type": "string"
                  },
                  "autorizacaoLanc": {
                    "type": "string"
                  },
                  "origem": {
                    "type": "string"
                  },
                  "seqIdAcesso": {
                    "type": "integer"
                  },
                  "sentido": {
                    "type": "string"
                  },
                  "quadra": {
                    "type": "string"
                  },
                  "lote": {
                    "type": "integer"
                  },
                  "panico": {
                    "type": "string"
                  },
                  "formaAcesso": {
                    "type": "string"
                  },
                  "idAcesso": {
                    "type": "string"
                  },
                  "seqVeiculo": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Acesso registrado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "string",
                      "example": "IDENT:..."
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/access/release/pedestrian": {
      "post": {
        "tags": [
          "Acessos"
        ],
        "summary": "Liberar acesso de pedestre",
        "description": "Libera o acesso imediato para pedestre (por exemplo, via botao ou comando externo).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "device",
                  "usuario",
                  "quadra",
                  "lote",
                  "motivo"
                ],
                "properties": {
                  "device": {
                    "type": "integer"
                  },
                  "usuario": {
                    "type": "string"
                  },
                  "quadra": {
                    "type": "string"
                  },
                  "lote": {
                    "type": "integer"
                  },
                  "motivo": {
                    "type": "string"
                  },
                  "complemento": {
                    "type": "string"
                  },
                  "seqAutorizador": {
                    "type": "integer"
                  },
                  "botaoTexto": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Acesso liberado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/access/release/vehicle": {
      "post": {
        "tags": [
          "Acessos"
        ],
        "summary": "Liberar acesso de veiculo",
        "description": "Libera o acesso imediato para veiculos (por exemplo, via botao ou comando externo).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "device",
                  "usuario",
                  "quadra",
                  "lote",
                  "motivo"
                ],
                "properties": {
                  "device": {
                    "type": "integer"
                  },
                  "usuario": {
                    "type": "string"
                  },
                  "quadra": {
                    "type": "string"
                  },
                  "lote": {
                    "type": "integer"
                  },
                  "motivo": {
                    "type": "string"
                  },
                  "complemento": {
                    "type": "string"
                  },
                  "seqAutorizador": {
                    "type": "integer"
                  },
                  "botaoTexto": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Acesso liberado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/vehicles": {
      "get": {
        "tags": [
          "Veiculos"
        ],
        "summary": "Listar veiculos",
        "description": "Retorna todos os veiculos cadastrados no sistema.",
        "responses": {
          "200": {
            "description": "Lista de veiculos retornada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    },
                    "message": {
                      "type": "string",
                      "nullable": true
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Veiculos"
        ],
        "summary": "Cadastrar veiculo",
        "description": "Cria um novo veiculo no sistema.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "plate",
                  "brand",
                  "model",
                  "color",
                  "user_seq",
                  "tag"
                ],
                "properties": {
                  "plate": {
                    "type": "string"
                  },
                  "brand": {
                    "type": "string"
                  },
                  "model": {
                    "type": "string"
                  },
                  "color": {
                    "type": "string"
                  },
                  "user_seq": {
                    "type": "integer"
                  },
                  "unit_seq": {
                    "type": "integer"
                  },
                  "tag": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Veiculo cadastrado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/vehicles/{id}": {
      "get": {
        "tags": [
          "Veiculos"
        ],
        "summary": "Obter veiculo",
        "description": "Retorna os dados de um veiculo especifico pelo ID.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID do veiculo"
          }
        ],
        "responses": {
          "200": {
            "description": "Dados do veiculo retornados com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/vehicles/{id}/photo": {
      "put": {
        "tags": [
          "Veiculos"
        ],
        "summary": "Atualizar imagem do veiculo",
        "description": "Atualiza a imagem do veiculo. Requer pelo menos uma das imagens.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "photoTag": {
                    "type": "string",
                    "format": "binary"
                  },
                  "photoVehicle": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Imagem atualizada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/vehicles/{id}/access": {
      "patch": {
        "tags": [
          "Veiculos"
        ],
        "summary": "Atualizar acesso do veiculo",
        "description": "Atualiza as informacoes de acesso do veiculo.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "personSequence",
                  "type",
                  "panic",
                  "id2",
                  "user",
                  "vehicleSequence"
                ],
                "properties": {
                  "personSequence": {
                    "type": "integer"
                  },
                  "type": {
                    "type": "string",
                    "example": "Y"
                  },
                  "panic": {
                    "type": "string",
                    "example": "N"
                  },
                  "id2": {
                    "type": "string",
                    "example": "0005629999"
                  },
                  "useType": {
                    "type": "string",
                    "example": "N"
                  },
                  "user": {
                    "type": "string",
                    "example": "JONH"
                  },
                  "vehicleSequence": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Acesso atualizado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/vehicles/{id}/lock": {
      "put": {
        "tags": [
          "Veiculos"
        ],
        "summary": "Bloquear veiculo",
        "description": "Bloqueia o acesso do veiculo no sistema.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "ID do veiculo",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Veiculo bloqueado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/vehicles/{id}/unlock": {
      "put": {
        "tags": [
          "Veiculos"
        ],
        "summary": "Desbloquear veiculo",
        "description": "Desbloqueia o acesso do veiculo no sistema.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "ID do veiculo",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Veiculo desbloqueado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/vehicles/purge": {
      "post": {
        "tags": [
          "Veiculos"
        ],
        "summary": "Purgar veiculos por periodo",
        "description": "Bloqueia o acesso de veiculos com base no periodo determinado.",
        "parameters": [
          {
            "in": "query",
            "name": "period",
            "required": false,
            "description": "Periodo em dias",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "period"
                ],
                "properties": {
                  "period": {
                    "type": "integer",
                    "description": "Periodo em dias"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Veiculos bloqueados com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v2/api/exaustors/on": {
      "post": {
        "tags": [
          "Exaustores"
        ],
        "summary": "Ligar exaustor",
        "description": "Liga o exaustor por pulso no relé. Informe bloco, apartamento e tempo em minutos.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "bloco",
                  "apartamento"
                ],
                "properties": {
                  "bloco": {
                    "type": "string",
                    "example": "A"
                  },
                  "apartamento": {
                    "type": "string",
                    "example": "123"
                  },
                  "tempo": {
                    "type": "number",
                    "format": "float",
                    "example": 10
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Exaustor ligado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Parâmetros inválidos"
          },
          "500": {
            "description": "Erro ao ligar exaustor"
          }
        }
      }
    },
    "/v2/api/exaustors/off": {
      "post": {
        "tags": [
          "Exaustores"
        ],
        "summary": "Desligar exaustor",
        "description": "Desliga o exaustor via módulo PWR e religa os demais do grupo.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "bloco",
                  "apartamento"
                ],
                "properties": {
                  "bloco": {
                    "type": "string",
                    "example": "A"
                  },
                  "apartamento": {
                    "type": "string",
                    "example": "123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Exaustor desligado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Parâmetros inválidos"
          },
          "500": {
            "description": "Erro ao desligar exaustor"
          }
        }
      }
    },
    "/v2/api/exaustors/status": {
      "get": {
        "tags": [
          "Exaustores"
        ],
        "summary": "Status geral dos módulos",
        "description": "Retorna o status de todos os módulos e a memória de acionamentos. Se informar id, retorna apenas o exaustor.",
        "parameters": [
          {
            "in": "query",
            "name": "id",
            "required": false,
            "description": "ID do exaustor (ex: A1, B-6, C_3)",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Status retornado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Parâmetros inválidos"
          },
          "500": {
            "description": "Erro ao consultar status"
          }
        }
      }
    },
    "/v2/api/exaustors/process/status": {
      "get": {
        "tags": [
          "Exaustores"
        ],
        "summary": "Status do processo de relés",
        "description": "Retorna a memória de relés gerenciada pela API.",
        "responses": {
          "200": {
            "description": "Status retornado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro ao consultar status do processo"
          }
        }
      }
    },
    "/v2/api/exaustors/config": {
      "post": {
        "tags": [
          "Exaustores"
        ],
        "summary": "Configurar módulo (Backlog)",
        "description": "Envia um comando backlog para o módulo Tasmota (comando já encodado).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "modulo",
                  "comando"
                ],
                "properties": {
                  "modulo": {
                    "type": "string",
                    "example": "1"
                  },
                  "comando": {
                    "type": "string",
                    "example": "Backlog%20PulseTime1%205;%20PulseTime2%205;%20PulseTime3%205;%20PulseTime4%205"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Comando enviado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "message": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    },
                    "errors": {
                      "type": "string",
                      "nullable": true,
                      "example": null
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Parâmetros inválidos"
          },
          "500": {
            "description": "Erro ao configurar módulo"
          }
        }
      }
    }
  }
}